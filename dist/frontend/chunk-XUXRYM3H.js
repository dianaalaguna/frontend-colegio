import{a as q}from"./chunk-GIHKOK6C.js";import{a as v,b as W,e as k,n as B}from"./chunk-KCB7IB6P.js";import{e as V}from"./chunk-K7YZQKDG.js";import{$a as _,Cb as M,Db as T,Eb as L,Ia as C,Ka as E,Ma as s,Na as o,Pa as b,Qa as p,Ra as a,Wa as d,Z as w,a as x,ab as g,bb as h,db as S,ga as c,ha as u,va as m,wa as y}from"./chunk-ZTNMYY3J.js";function F(l,f){if(l&1){let e=b();s(0,"button",10),p("click",function(){c(e);let t=a();return u(t.resetBusqueda())}),d(1,"Limpiar"),o()}}function N(l,f){if(l&1){let e=b();s(0,"tr")(1,"td")(2,"input",11),h("ngModelChange",function(t){let n=c(e).$implicit,r=a();return g(r.editCache[n.codigoEstudiante].codigoEstudiante,t)||(r.editCache[n.codigoEstudiante].codigoEstudiante=t),u(t)}),o()(),s(3,"td")(4,"input",12),h("ngModelChange",function(t){let n=c(e).$implicit,r=a();return g(r.editCache[n.codigoEstudiante].nombres,t)||(r.editCache[n.codigoEstudiante].nombres=t),u(t)}),p("input",function(){let t=c(e).$implicit,n=a();return u(n.onChange(t.codigoEstudiante,"nombres",n.editCache[t.codigoEstudiante].nombres))}),o()(),s(5,"td")(6,"input",12),h("ngModelChange",function(t){let n=c(e).$implicit,r=a();return g(r.editCache[n.codigoEstudiante].apellidos,t)||(r.editCache[n.codigoEstudiante].apellidos=t),u(t)}),p("input",function(){let t=c(e).$implicit,n=a();return u(n.onChange(t.codigoEstudiante,"apellidos",n.editCache[t.codigoEstudiante].apellidos))}),o()(),s(7,"td")(8,"input",12),h("ngModelChange",function(t){let n=c(e).$implicit,r=a();return g(r.editCache[n.codigoEstudiante].correoTutor,t)||(r.editCache[n.codigoEstudiante].correoTutor=t),u(t)}),p("input",function(){let t=c(e).$implicit,n=a();return u(n.onChange(t.codigoEstudiante,"correoTutor",n.editCache[t.codigoEstudiante].correoTutor))}),o()(),s(9,"td")(10,"input",11),h("ngModelChange",function(t){let n=c(e).$implicit,r=a();return g(r.editCache[n.codigoEstudiante].nacimiento,t)||(r.editCache[n.codigoEstudiante].nacimiento=t),u(t)}),o()(),s(11,"td")(12,"button",13),p("click",function(){let t=c(e).$implicit,n=a();return u(n.saveChanges(t.codigoEstudiante))}),d(13,"Guardar"),o(),s(14,"button",14),p("click",function(){let t=c(e).$implicit,n=a();return u(n.deleteUser(t.codigoEstudiante))}),d(15,"Eliminar"),o()()()}if(l&2){let e=f.$implicit,i=a();m(2),_("ngModel",i.editCache[e.codigoEstudiante].codigoEstudiante),m(2),_("ngModel",i.editCache[e.codigoEstudiante].nombres),m(2),_("ngModel",i.editCache[e.codigoEstudiante].apellidos),m(2),_("ngModel",i.editCache[e.codigoEstudiante].correoTutor),m(2),_("ngModel",i.editCache[e.codigoEstudiante].nacimiento),m(2),E("disabled",!i.hasChanges(e.codigoEstudiante))}}function I(l,f){l&1&&(s(0,"div",15),d(1," No se encontraron estudiantes. "),o())}var G=(()=>{class l{constructor(e){this.studentService=e,this.estudiantes=[],this.editCache={},this.busquedaEmailTutor=""}ngOnInit(){this.loadEstudiantes()}loadEstudiantes(){this.studentService.getStudents().subscribe({next:e=>{this.estudiantes=e,this.inicializarEditCache()},error:e=>{console.error("Error al cargar los estudiantes",e)}})}buscarEstudiante(){let e=this.busquedaEmailTutor.trim();e&&this.studentService.getStudentsByEmail(e).subscribe({next:i=>{this.estudiantes=i,this.inicializarEditCache()},error:i=>{console.error("Usuario no encontrado",i),this.estudiantes=[]}})}inicializarEditCache(){this.editCache={},this.estudiantes.forEach(e=>{this.editCache[e.codigoEstudiante]=x({},e)})}hasChanges(e){return JSON.stringify(this.editCache[e])!==JSON.stringify(this.estudiantes.find(i=>i.codigoEstudiante===e))}onChange(e,i,t){this.editCache[e]&&(this.editCache[e][i]=t)}saveChanges(e){let i=this.editCache[e];console.log("Guardando estudiante:",i),this.studentService.updateStudent(e,i).subscribe({next:()=>{console.log("Estudiante actualizado"),this.loadEstudiantes()},error:t=>{console.error("Error al guardar los cambios",t)}})}deleteUser(e){window.confirm("\xBFEst\xE1s seguro de que deseas eliminar este estudiante?")&&this.studentService.deleteUser(e).subscribe({next:()=>{console.log("Usuario eliminado"),this.loadEstudiantes()},error:t=>{console.error("Error al eliminar el usuario",t)}})}resetBusqueda(){this.busquedaEmailTutor="",this.loadEstudiantes()}static{this.\u0275fac=function(i){return new(i||l)(y(q))}}static{this.\u0275cmp=w({type:l,selectors:[["app-estudiantes-lista"]],standalone:!0,features:[S],decls:27,vars:4,consts:[[1,"container","mt-4"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"input-group",2,"width","300px"],["type","email","placeholder","Buscar por email",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-primary",3,"click"],["class","btn btn-secondary",3,"click",4,"ngIf"],[1,"table","table-bordered","table-hover"],[1,"table-dark"],[4,"ngFor","ngForOf"],["class","alert alert-warning text-center",4,"ngIf"],[1,"btn","btn-secondary",3,"click"],["readonly","",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-control",3,"ngModelChange","input","ngModel"],[1,"btn","btn-success","btn-sm","me-2",3,"click","disabled"],[1,"btn","btn-danger","btn-sm",3,"click"],[1,"alert","alert-warning","text-center"]],template:function(i,t){i&1&&(s(0,"div",0)(1,"div",1)(2,"h2"),d(3,"\u{1F465} Lista de Estudiantes"),o(),s(4,"div",2)(5,"input",3),h("ngModelChange",function(r){return g(t.busquedaEmailTutor,r)||(t.busquedaEmailTutor=r),r}),o(),s(6,"button",4),p("click",function(){return t.buscarEstudiante()}),d(7,"Buscar"),o(),C(8,F,2,0,"button",5),o()(),s(9,"table",6)(10,"thead",7)(11,"tr")(12,"th"),d(13,"C\xF3digo"),o(),s(14,"th"),d(15,"Nombres"),o(),s(16,"th"),d(17,"Apellidos"),o(),s(18,"th"),d(19,"E-Mail tutor"),o(),s(20,"th"),d(21,"Cumplea\xF1os"),o(),s(22,"th"),d(23,"Acciones"),o()()(),s(24,"tbody"),C(25,N,16,6,"tr",8),o()(),C(26,I,2,0,"div",9),o()),i&2&&(m(5),_("ngModel",t.busquedaEmailTutor),m(3),E("ngIf",t.busquedaEmailTutor),m(17),E("ngForOf",t.estudiantes),m(),E("ngIf",t.estudiantes.length===0))},dependencies:[B,v,W,k,V,L,M,T]})}}return l})();export{G as EstudiantesListaComponent};
