import{a as B}from"./chunk-2W3Z6WZ4.js";import{a as T,b as W,e as k,n as q}from"./chunk-KCB7IB6P.js";import{e as v}from"./chunk-K7YZQKDG.js";import{$a as _,Cb as E,Db as M,Eb as V,Ia as f,Ka as g,Ma as o,Na as r,Pa as x,Qa as p,Ra as a,Wa as u,Z as U,a as w,ab as h,bb as C,db as S,ga as c,ha as m,va as d,wa as y}from"./chunk-ZTNMYY3J.js";function N(l,b){if(l&1){let t=x();o(0,"button",10),p("click",function(){c(t);let e=a();return m(e.resetBusqueda())}),u(1,"Limpiar"),r()}}function F(l,b){if(l&1){let t=x();o(0,"tr")(1,"td")(2,"input",11),C("ngModelChange",function(e){let n=c(t).$implicit,s=a();return h(s.editCache[n.username].nombres,e)||(s.editCache[n.username].nombres=e),m(e)}),p("input",function(){let e=c(t).$implicit,n=a();return m(n.onChange(e.username,"nombres",n.editCache[e.username].nombres))}),r()(),o(3,"td")(4,"input",11),C("ngModelChange",function(e){let n=c(t).$implicit,s=a();return h(s.editCache[n.username].apellidos,e)||(s.editCache[n.username].apellidos=e),m(e)}),p("input",function(){let e=c(t).$implicit,n=a();return m(n.onChange(e.username,"apellidos",n.editCache[e.username].apellidos))}),r()(),o(5,"td")(6,"input",11),C("ngModelChange",function(e){let n=c(t).$implicit,s=a();return h(s.editCache[n.username].telefono,e)||(s.editCache[n.username].telefono=e),m(e)}),p("input",function(){let e=c(t).$implicit,n=a();return m(n.onChange(e.username,"telefono",n.editCache[e.username].telefono))}),r()(),o(7,"td")(8,"input",12),C("ngModelChange",function(e){let n=c(t).$implicit,s=a();return h(s.editCache[n.username].username,e)||(s.editCache[n.username].username=e),m(e)}),r()(),o(9,"td")(10,"button",13),p("click",function(){let e=c(t).$implicit,n=a();return m(n.saveChanges(e.username))}),u(11,"Guardar"),r(),o(12,"button",14),p("click",function(){let e=c(t).$implicit,n=a();return m(n.deleteUser(e.username))}),u(13,"Eliminar"),r()()()}if(l&2){let t=b.$implicit,i=a();d(2),_("ngModel",i.editCache[t.username].nombres),d(2),_("ngModel",i.editCache[t.username].apellidos),d(2),_("ngModel",i.editCache[t.username].telefono),d(2),_("ngModel",i.editCache[t.username].username),d(2),g("disabled",!i.hasChanges(t.username))}}function I(l,b){l&1&&(o(0,"div",15),u(1," No se encontraron usuarios. "),r())}var J=(()=>{class l{constructor(t){this.userService=t,this.usuarios=[],this.editCache={},this.busquedaUsername=""}ngOnInit(){this.loadUsuarios()}loadUsuarios(){this.userService.getUsers().subscribe({next:t=>{this.usuarios=t,this.inicializarEditCache()},error:t=>{console.error("Error al cargar los usuarios",t)}})}buscarUsuario(){let t=this.busquedaUsername.trim();t&&this.userService.getUserByUsername(t).subscribe({next:i=>{this.usuarios=[i],this.inicializarEditCache()},error:i=>{console.error("Usuario no encontrado",i),this.usuarios=[]}})}inicializarEditCache(){this.editCache={},this.usuarios.forEach(t=>{this.editCache[t.username]=w({},t)})}hasChanges(t){return JSON.stringify(this.editCache[t])!==JSON.stringify(this.usuarios.find(i=>i.username===t))}onChange(t,i,e){this.editCache[t]&&(this.editCache[t][i]=e)}saveChanges(t){let i=this.editCache[t];this.userService.updateUser(t,i).subscribe({next:()=>{console.log("Usuario actualizado"),this.loadUsuarios()},error:e=>{console.error("Error al guardar los cambios",e)}})}deleteUser(t){window.confirm("\xBFEst\xE1s seguro de que deseas eliminar este usuario?")&&this.userService.deleteUser(t).subscribe({next:()=>{console.log("Usuario eliminado"),this.loadUsuarios()},error:e=>{console.error("Error al eliminar el usuario",e)}})}resetBusqueda(){this.busquedaUsername="",this.loadUsuarios()}static{this.\u0275fac=function(i){return new(i||l)(y(B))}}static{this.\u0275cmp=U({type:l,selectors:[["app-usuarios"]],standalone:!0,features:[S],decls:25,vars:4,consts:[[1,"container","mt-4"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"input-group",2,"width","300px"],["type","email","placeholder","Buscar por email",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-primary",3,"click"],["class","btn btn-secondary",3,"click",4,"ngIf"],[1,"table","table-bordered","table-hover"],[1,"table-dark"],[4,"ngFor","ngForOf"],["class","alert alert-warning text-center",4,"ngIf"],[1,"btn","btn-secondary",3,"click"],[1,"form-control",3,"ngModelChange","input","ngModel"],["readonly","",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-success","btn-sm","me-2",3,"click","disabled"],[1,"btn","btn-danger","btn-sm",3,"click"],[1,"alert","alert-warning","text-center"]],template:function(i,e){i&1&&(o(0,"div",0)(1,"div",1)(2,"h2"),u(3,"\u{1F465} Lista de Usuarios"),r(),o(4,"div",2)(5,"input",3),C("ngModelChange",function(s){return h(e.busquedaUsername,s)||(e.busquedaUsername=s),s}),r(),o(6,"button",4),p("click",function(){return e.buscarUsuario()}),u(7,"Buscar"),r(),f(8,N,2,0,"button",5),r()(),o(9,"table",6)(10,"thead",7)(11,"tr")(12,"th"),u(13,"Nombres"),r(),o(14,"th"),u(15,"Apellidos"),r(),o(16,"th"),u(17,"Tel\xE9fono"),r(),o(18,"th"),u(19,"E-Mail"),r(),o(20,"th"),u(21,"Acciones"),r()()(),o(22,"tbody"),f(23,F,14,5,"tr",8),r()(),f(24,I,2,0,"div",9),r()),i&2&&(d(5),_("ngModel",e.busquedaUsername),d(3),g("ngIf",e.busquedaUsername),d(15),g("ngForOf",e.usuarios),d(),g("ngIf",e.usuarios.length===0))},dependencies:[q,T,W,k,v,V,E,M]})}}return l})();export{J as UsuariosComponent};
